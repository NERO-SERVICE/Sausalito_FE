import{m,a as d,x as i,y as l,z as o,A as u,s as w,g as c,d as h}from"./footer-CX_4Vxnh.js";import{c as f}from"./cart-service-BJL0NQK-.js";const y=m({showCart:!0,currentNav:""});d();const t={user:null},e={profileForm:document.getElementById("memberProfileForm"),passwordForm:document.getElementById("memberPasswordForm"),withdrawForm:document.getElementById("memberWithdrawForm"),email:document.getElementById("memberEditEmail"),name:document.getElementById("memberEditName"),phone:document.getElementById("memberEditPhone"),oldPassword:document.getElementById("memberOldPassword"),newPassword:document.getElementById("memberNewPassword"),newPasswordConfirm:document.getElementById("memberNewPasswordConfirm"),withdrawPassword:document.getElementById("memberWithdrawPassword"),withdrawReason:document.getElementById("memberWithdrawReason"),withdrawConfirm:document.getElementById("memberWithdrawConfirm")};async function s(){let a=0;try{a=await f()}catch{a=0}h(y,{userName:t.user?.name||t.user?.email||null,isAdmin:!!(t.user?.is_staff??t.user?.isStaff),cartCountValue:a})}function n(){e.email.value=t.user?.email||"",e.name.value=t.user?.name||"",e.phone.value=t.user?.phone||""}e.profileForm?.addEventListener("submit",async a=>{a.preventDefault();try{const r=await i({name:e.name.value.trim(),phone:e.phone.value.trim()});t.user={...t.user,...r},n(),await s(),alert("회원정보가 저장되었습니다.")}catch(r){console.error(r),alert(r.message||"회원정보 저장에 실패했습니다.")}});e.passwordForm?.addEventListener("submit",async a=>{a.preventDefault();try{await l({oldPassword:e.oldPassword.value,newPassword:e.newPassword.value,newPasswordConfirm:e.newPasswordConfirm.value}),e.oldPassword.value="",e.newPassword.value="",e.newPasswordConfirm.value="",alert("비밀번호가 변경되었습니다. 다시 로그인해주세요."),await o(),location.href="/pages/login.html"}catch(r){console.error(r),alert(r.message||"비밀번호 변경에 실패했습니다.")}});e.withdrawForm?.addEventListener("submit",async a=>{a.preventDefault();try{if(!e.withdrawConfirm.checked){alert("탈퇴 동의 체크를 완료해주세요.");return}if(!confirm("정말 회원 탈퇴를 진행하시겠습니까?"))return;await u({password:e.withdrawPassword.value,reason:e.withdrawReason.value.trim()}),await o(),alert("회원 탈퇴가 완료되었습니다."),location.href="/pages/home.html"}catch(r){console.error(r),alert(r.message||"회원 탈퇴 처리에 실패했습니다.")}});(async function(){const r=await w()||c();if(!r){alert("로그인 후 이용할 수 있습니다."),location.href="/pages/login.html";return}t.user=r,n(),await s()})();
