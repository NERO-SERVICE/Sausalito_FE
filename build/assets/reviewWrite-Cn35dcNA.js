import{m as l,a as u,g as o,h as m,s as i,f as d,d as f}from"./footer-D65fayHX.js";import{c as g}from"./cart-service-BIgm5nvz.js";const h=l({showCart:!0,currentNav:"review"});u();const c=document.getElementById("reviewWriteForm"),w=document.getElementById("reviewProductSelect"),a=document.getElementById("reviewImagesInput"),p=document.getElementById("reviewImagePreview"),v=Number(new URLSearchParams(location.search).get("productId"));async function y(){const t=await i()||o();let e=0;try{e=await g()}catch{e=0}f(h,{userName:t?.name||null,cartCountValue:e})}function I(t){p.innerHTML=t.map(e=>`<img src="${URL.createObjectURL(e)}" alt="리뷰 이미지 미리보기" />`).join("")}a.addEventListener("change",()=>{const t=[...a.files].slice(0,3);a.files.length>3&&alert("이미지는 최대 3장까지 첨부할 수 있습니다.");const e=new DataTransfer;t.forEach(r=>e.items.add(r)),a.files=e.files,I(t)});c.addEventListener("submit",async t=>{if(t.preventDefault(),!o()){alert("리뷰 작성은 로그인 후 가능합니다."),location.href="/pages/login.html";return}const r=Object.fromEntries(new FormData(c).entries()),n=[...a.files].slice(0,3);try{await m({productId:Number(r.productId),score:Number(r.score),title:r.title,content:r.content,images:n}),alert("리뷰가 등록되었습니다."),location.href="/pages/reviews.html"}catch(s){if(console.error(s),s.status===401){alert("로그인이 만료되었습니다. 다시 로그인해주세요."),location.href="/pages/login.html";return}alert(s.message||"리뷰 등록에 실패했습니다.")}});(async function(){try{if(!(await i()||o())){alert("리뷰 작성은 로그인 후 가능합니다."),location.href="/pages/login.html";return}const r=await d();w.innerHTML=r.map(n=>`<option value="${n.id}" ${n.id===v?"selected":""}>${n.name}</option>`).join(""),await y()}catch(e){console.error(e),alert("리뷰 작성 페이지 초기화에 실패했습니다.")}})();
