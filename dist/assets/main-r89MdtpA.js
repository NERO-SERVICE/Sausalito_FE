import{S as c,r as w,p,f as l,a as D,b as N,c as H}from"./store-data-CSIjrcqu.js";const r={cart:JSON.parse(localStorage.getItem(c.cart)||"[]"),wishlist:JSON.parse(localStorage.getItem(c.wishlist)||"[]"),orders:JSON.parse(localStorage.getItem(c.orders)||"[]"),user:JSON.parse(localStorage.getItem(c.user)||"null"),promoHidden:JSON.parse(localStorage.getItem(c.promoHidden)||"false"),authMode:"login",coupon:null,reviewFilter:"all",reviewHighOnly:!1,monthlyIndex:0},v=[{subtitle:"APRIL CURATION",title:`이달의 아이템 #1
데일리 멀티 루틴`,description:"활력 밸런스를 위한 멀티비타민 큐레이션. 매일 꾸준히 시작해보세요.",promoText:`이번 달 추천
기초 영양 루틴`,image:"/dist/img/products/dummy1.png",detailId:1},{subtitle:"APRIL CURATION",title:`이달의 아이템 #2
혈행 케어 스페셜`,description:"오메가3 중심으로 구성한 집중 케어. 바쁜 일상 속 건강 관리에 적합합니다.",promoText:`지금 가장 인기 있는
혈행 집중 솔루션`,image:"/dist/img/products/dummy2.png",detailId:2},{subtitle:"APRIL CURATION",title:`이달의 아이템 #3
장 컨디션 리셋 팩`,description:"장 건강 루틴을 위한 베스트 조합. 아침 루틴으로 시작하기 좋습니다.",promoText:`편안한 하루를 위한
장 건강 제안`,image:"/dist/img/products/p3.svg",detailId:3},{subtitle:"APRIL CURATION",title:`이달의 아이템 #4
이너뷰티 스타터`,description:"피부 탄력과 보습을 동시에 챙길 수 있는 뷰티 루틴 셀렉션입니다.",promoText:`오늘부터 시작하는
이너뷰티 루틴`,image:"/dist/img/products/p4.svg",detailId:4}],O={WELCOME20:{type:"percent",value:20,label:"신규회원 20%"},FREESHIP:{type:"shipping",value:3e3,label:"배송비 무료"}},R=[{key:"all",label:"전체 리뷰"},{key:"5",label:"5점 리뷰"},{key:"4",label:"4점 이상"},{key:"3",label:"3점 이하"}],n={body:document.body,promoClose:document.getElementById("promoClose"),monthlyTrack:document.getElementById("monthlyTrack"),monthlyDots:document.getElementById("monthlyDots"),monthlyPrev:document.getElementById("monthlyPrev"),monthlyNext:document.getElementById("monthlyNext"),productGrid:document.getElementById("productGrid"),searchInput:document.getElementById("searchInput"),priceFilter:document.getElementById("priceFilter"),sortFilter:document.getElementById("sortFilter"),cartCount:document.getElementById("cartCount"),wishlistCount:document.getElementById("wishlistCount"),cartItems:document.getElementById("cartItems"),wishlistItems:document.getElementById("wishlistItems"),priceSummary:document.getElementById("priceSummary"),couponInput:document.getElementById("couponInput"),reviewSummary:document.getElementById("reviewSummary"),reviewFilterRow:document.getElementById("reviewFilterRow"),reviewCards:document.getElementById("reviewCards"),reviewHighBtn:document.getElementById("reviewHighBtn"),authBtn:document.getElementById("authBtn"),authTitle:document.getElementById("authTitle"),authForm:document.getElementById("authForm"),authEmail:document.getElementById("authEmail"),authPassword:document.getElementById("authPassword"),authName:document.getElementById("authName"),toggleAuthMode:document.getElementById("toggleAuthMode"),checkoutForm:document.getElementById("checkoutForm"),ordersList:document.getElementById("ordersList")};let g=null;function E(t){r.monthlyIndex=t;const e=[...document.querySelectorAll(".monthly-slide")],o=[...document.querySelectorAll(".monthly-dot")];e.forEach((i,a)=>i.classList.toggle("active",a===t)),o.forEach((i,a)=>i.classList.toggle("active",a===t))}function C(t){const e=(r.monthlyIndex+t+v.length)%v.length;E(e)}function A(){!n.monthlyTrack||!n.monthlyDots||(n.monthlyTrack.innerHTML=v.map((t,e)=>`
      <article class="monthly-slide ${e===0?"active":""}">
        <p class="monthly-promo-text">${t.promoText.replace(/\n/g,"<br />")}</p>
        <div class="monthly-image-wrap">
          <img src="${t.image}" alt="${t.title}" loading="eager" />
        </div>
        <div class="monthly-content">
          <p class="monthly-subtitle">${t.subtitle}</p>
          <h2 class="monthly-title">${t.title.replace(/\n/g,"<br />")}</h2>
          <p class="monthly-desc">${t.description}</p>
          <a class="primary link-btn" href="pages/detail.html?id=${t.detailId}">자세히보기</a>
        </div>
      </article>`).join(""),n.monthlyDots.innerHTML=v.map((t,e)=>`<button class="monthly-dot ${e===0?"active":""}" data-monthly-dot="${e}" aria-label="${e+1}번 배너"></button>`).join(""))}function h(){g&&clearInterval(g),g=setInterval(()=>{const t=(r.monthlyIndex+1)%v.length;E(t)},4e3)}function u(){localStorage.setItem(c.cart,JSON.stringify(r.cart)),localStorage.setItem(c.wishlist,JSON.stringify(r.wishlist)),localStorage.setItem(c.orders,JSON.stringify(r.orders)),localStorage.setItem(c.user,JSON.stringify(r.user)),localStorage.setItem(c.promoHidden,JSON.stringify(r.promoHidden))}function L(){return r.cart.map(t=>{const e=p.find(o=>o.id===t.productId);return e?{...t,product:e}:null}).filter(Boolean)}function F(){const e=L().reduce((s,d)=>s+d.product.price*d.quantity,0),o=e>0&&e<3e4?3e3:0;let i=0,a="-";return r.coupon?.type==="percent"&&(i=Math.floor(e*r.coupon.value/100),a=`${r.coupon.label} (-${l(i)})`),r.coupon?.type==="shipping"&&(i=Math.min(o,r.coupon.value),a=`${r.coupon.label} (-${l(i)})`),{subtotal:e,shipping:o,discount:i,total:Math.max(0,e+o-i),discountText:a}}function P(){const t=n.searchInput.value.trim().toLowerCase(),e=n.priceFilter.value,o=n.sortFilter.value;let i=[...p];if(t&&(i=i.filter(a=>a.name.toLowerCase().includes(t)||a.description.toLowerCase().includes(t)||a.ingredients.some(s=>s.toLowerCase().includes(t)))),e!=="all"){const[a,s]=e.split("-").map(Number);i=i.filter(d=>d.price>=a&&d.price<=s)}return o==="popular"&&i.sort((a,s)=>s.popularScore-a.popularScore),o==="newest"&&i.sort((a,s)=>new Date(s.releaseDate)-new Date(a.releaseDate)),o==="priceAsc"&&i.sort((a,s)=>a.price-s.price),o==="priceDesc"&&i.sort((a,s)=>s.price-a.price),i}function $(){const t=P();if(!t.length){n.productGrid.innerHTML='<p class="empty">조건에 맞는 상품이 없습니다.</p>';return}n.productGrid.innerHTML=t.map(e=>q(e,`pages/detail.html?id=${e.id}`)).join("")}function q(t,e){const o=Math.round((1-t.price/t.originalPrice)*100),i=t.reviews.toLocaleString("ko-KR"),a=N(t.image),s=H(t.image);return`
    <a class="product-card product-card-link" href="${e}" aria-label="${t.name} 상세페이지로 이동">
      <div class="product-thumb">
        <div class="product-badges">
          ${(t.badges||[]).slice(0,2).map(d=>`<span class="product-badge">${d}</span>`).join("")}
        </div>
        <img
          src="${a}"
          data-fallback="${s}"
          alt="${t.name}"
          loading="lazy"
          onerror="if(this.dataset.fallback && this.src !== this.dataset.fallback){this.src=this.dataset.fallback;}"
        />
      </div>
      <div class="product-meta">
        <h4>${t.name}</h4>
        <p>${t.oneLine||t.description}</p>
      </div>
      <div class="price-stack">
        <small class="old-price">${l(t.originalPrice)}</small>
        <div class="new-price-row">
          <span class="discount-rate">${o}%</span>
          <strong class="new-price">${l(t.price)}</strong>
        </div>
      </div>
      <div class="review-count">리뷰 (${i})</div>
    </a>
  `}function j(){let t=[...w];return r.reviewFilter==="5"&&(t=t.filter(e=>e.score===5)),r.reviewFilter==="4"&&(t=t.filter(e=>e.score>=4)),r.reviewFilter==="3"&&(t=t.filter(e=>e.score<=3)),r.reviewHighOnly&&(t=t.filter(e=>e.score>=5)),t.sort((e,o)=>o.helpful-e.helpful)}function J(){const t={5:0,4:0,3:0,2:0,1:0};w.forEach(i=>t[i.score]+=1);const e=w.length,o=(w.reduce((i,a)=>i+a.score,0)/e).toFixed(1);n.reviewSummary.innerHTML=`
    <div class="review-score">
      <strong>${o}</strong>
      <div>${"★".repeat(Math.round(Number(o)))}${"☆".repeat(5-Math.round(Number(o)))}</div>
      <small>총 ${e}개 리뷰</small>
    </div>
    <div class="review-bars">
      ${[5,4,3,2,1].map(i=>{const a=t[i],s=e?Math.round(a/e*100):0;return`<div class="review-bar"><span>${i}점</span><div class="review-bar-track"><div class="review-bar-fill" style="width:${s}%"></div></div><span>${a}</span></div>`}).join("")}
    </div>`}function T(){n.reviewFilterRow.innerHTML=R.map(t=>`<button class="review-chip ${r.reviewFilter===t.key?"active":""}" data-review-filter="${t.key}">${t.label}</button>`).join("")}function M(){const t=j();if(!t.length){n.reviewCards.innerHTML='<p class="empty">선택된 조건의 리뷰가 없습니다.</p>';return}n.reviewCards.innerHTML=t.map(e=>{const o=p.find(i=>i.id===e.productId);return`<article class="review-card">
        <div class="review-card-head"><span>${e.user} · ${e.date}</span><strong>${"★".repeat(e.score)}${"☆".repeat(5-e.score)}</strong></div>
        <p>${e.text}</p>
        <small style="color:#5d7683">구매 옵션: ${e.option}</small>
        <div class="review-foot"><span>도움돼요 ${e.helpful}</span><a class="text-btn link-btn" href="pages/detail.html?id=${e.productId}">${o?.name||"상품"} 보기</a></div>
      </article>`}).join("")}function m(){const t=L();n.cartCount.textContent=r.cart.reduce((o,i)=>o+i.quantity,0),n.cartItems.innerHTML=t.length===0?'<p class="empty">장바구니가 비어 있습니다.</p>':t.map(o=>`<article class="cart-item"><strong>${o.product.name}</strong><p>${l(o.product.price)} x ${o.quantity}</p><div style="display:flex;justify-content:space-between;align-items:center;gap:8px;"><div class="qty-controls"><button data-action="decreaseQty" data-id="${o.product.id}">-</button><span>${o.quantity}</span><button data-action="increaseQty" data-id="${o.product.id}">+</button></div><button class="text-btn" data-action="removeFromCart" data-id="${o.product.id}">삭제</button></div></article>`).join("");const e=F();n.priceSummary.innerHTML=`<div>상품금액 <strong>${l(e.subtotal)}</strong></div><div>배송비 <strong>${l(e.shipping)}</strong></div><div>할인 <strong>${e.discount?"-":""}${l(e.discount)}</strong></div><div style="color:#5d7683;font-size:0.82rem">${e.discountText}</div><div style="font-size:1.04rem">총 결제금액 <strong>${l(e.total)}</strong></div>`}function x(){const t=p.filter(e=>r.wishlist.includes(e.id));n.wishlistCount.textContent=r.wishlist.length,n.wishlistItems.innerHTML=t.length===0?'<p class="empty">찜한 상품이 없습니다.</p>':t.map(e=>`<article class="wish-item"><strong>${e.name}</strong><p>${l(e.price)}</p><div style="display:flex;gap:8px;"><button class="primary" data-action="addToCart" data-id="${e.id}">장바구니 담기</button><button class="text-btn" data-action="toggleWish" data-id="${e.id}">삭제</button></div></article>`).join("")}function S(){if(!r.orders.length){n.ordersList.innerHTML='<p class="empty">아직 주문 내역이 없습니다.</p>';return}n.ordersList.innerHTML=r.orders.slice().reverse().map(t=>`<article class="order-item"><strong>${t.orderId} · ${t.date}</strong><p>${t.items.map(e=>`${e.name} x ${e.quantity}`).join(", ")}</p><p>결제수단: ${D(t.paymentMethod)} · 총액: ${l(t.total)}</p><button class="ghost" data-action="reorder" data-order-id="${t.orderId}">재주문</button></article>`).join("")}function k(){n.authBtn.textContent=r.user?`${r.user.name}님`:"로그인"}function B(t,e=1){const o=p.find(a=>a.id===t);if(!o)return;const i=r.cart.find(a=>a.productId===t);i?i.quantity=Math.min(i.quantity+e,o.stock):r.cart.push({productId:t,quantity:Math.min(e,o.stock)}),m(),u()}function G(t){r.wishlist=r.wishlist.includes(t)?r.wishlist.filter(e=>e!==t):[...r.wishlist,t],$(),x(),u()}function f(t){document.getElementById(t).classList.add("open")}function I(t){document.getElementById(t).classList.remove("open")}function b(t){document.getElementById(t).classList.remove("open")}function y(t){document.getElementById(t).classList.add("open")}function U(){return r.user?!0:(y("authModal"),!1)}function W(t){const e=L();if(!e.length)return;const o=F(),i={orderId:`SL-${Date.now().toString().slice(-8)}`,date:new Date().toLocaleDateString("ko-KR"),paymentMethod:t.paymentMethod,items:e.map(a=>({name:a.product.name,quantity:a.quantity})),total:o.total};r.orders.push(i),r.cart=[],r.coupon=null,u(),m(),S(),b("checkoutModal"),I("cartDrawer"),y("ordersModal")}function Q(){[n.searchInput,n.priceFilter,n.sortFilter].forEach(t=>{t.addEventListener("input",$),t.addEventListener("change",$)}),n.monthlyDots&&n.monthlyDots.addEventListener("click",t=>{const e=t.target.closest("[data-monthly-dot]");e&&(E(Number(e.dataset.monthlyDot)),h())}),n.monthlyPrev&&n.monthlyPrev.addEventListener("click",()=>{C(-1),h()}),n.monthlyNext&&n.monthlyNext.addEventListener("click",()=>{C(1),h()}),n.monthlyTrack&&(n.monthlyTrack.addEventListener("mouseenter",()=>{g&&clearInterval(g)}),n.monthlyTrack.addEventListener("mouseleave",h)),n.reviewFilterRow.addEventListener("click",t=>{const e=t.target.closest("[data-review-filter]");e&&(r.reviewFilter=e.dataset.reviewFilter,T(),M())}),n.reviewHighBtn.addEventListener("click",()=>{r.reviewHighOnly=!r.reviewHighOnly,n.reviewHighBtn.textContent=r.reviewHighOnly?"전체 리뷰 보기":"평점 4.5 이상만 보기",M()}),document.addEventListener("click",t=>{const e=t.target,o=e.dataset.action;if(o==="addToCart"&&(B(Number(e.dataset.id),1),f("cartDrawer")),o==="toggleWish"&&G(Number(e.dataset.id)),o==="removeFromCart"&&(r.cart=r.cart.filter(i=>i.productId!==Number(e.dataset.id)),m(),u()),o==="increaseQty"&&B(Number(e.dataset.id),1),o==="decreaseQty"){const i=r.cart.find(a=>a.productId===Number(e.dataset.id));if(!i)return;i.quantity-=1,i.quantity<=0&&(r.cart=r.cart.filter(a=>a.productId!==Number(e.dataset.id))),m(),u()}if(o==="reorder"){const i=r.orders.find(a=>a.orderId===e.dataset.orderId);if(!i)return;i.items.forEach(a=>{const s=p.find(d=>d.name===a.name);s&&B(s.id,a.quantity)}),b("ordersModal"),f("cartDrawer")}e.dataset.close&&(e.dataset.close.includes("Drawer")?I(e.dataset.close):b(e.dataset.close)),e.id==="cartBtn"&&f("cartDrawer"),e.id==="wishlistBtn"&&f("wishlistDrawer"),e.id==="ordersBtn"&&(S(),y("ordersModal")),e.id==="authBtn"&&(r.user&&confirm("로그아웃 하시겠습니까?")?(r.user=null,u(),k()):r.user||y("authModal"))}),document.addEventListener("click",t=>{const e=t.target.closest(".drawer"),o=t.target.closest("#cartBtn, #wishlistBtn");!e&&!o&&(I("cartDrawer"),I("wishlistDrawer"))}),document.querySelectorAll(".modal").forEach(t=>{t.addEventListener("click",e=>{e.target===t&&t.classList.remove("open")})}),document.getElementById("applyCouponBtn").addEventListener("click",()=>{const t=n.couponInput.value.trim().toUpperCase(),e=O[t];if(!e){alert("사용할 수 없는 쿠폰입니다.");return}r.coupon=e,m()}),document.getElementById("checkoutBtn").addEventListener("click",()=>{if(!L().length){alert("장바구니가 비어 있습니다.");return}U()&&y("checkoutModal")}),n.authForm.addEventListener("submit",t=>{t.preventDefault();const e=n.authEmail.value.trim(),o=n.authPassword.value.trim(),i=n.authName.value.trim();if(!(!e||!o)){if(r.authMode==="signup"){if(!i)return alert("이름을 입력해주세요.");r.user={email:e,name:i}}else r.user={email:e,name:e.split("@")[0]};u(),k(),b("authModal"),n.authForm.reset()}}),n.toggleAuthMode.addEventListener("click",()=>{r.authMode=r.authMode==="login"?"signup":"login";const t=r.authMode==="signup";n.authTitle.textContent=t?"회원가입":"로그인",n.authName.classList.toggle("hidden",!t),n.toggleAuthMode.textContent=t?"로그인 하기":"회원가입 하기"}),n.checkoutForm.addEventListener("submit",t=>{t.preventDefault();const e=Object.fromEntries(new FormData(n.checkoutForm).entries());if(!e.paymentMethod)return alert("결제수단을 선택해주세요.");W(e),n.checkoutForm.reset()}),n.promoClose.addEventListener("click",()=>{r.promoHidden=!0,n.body.classList.add("promo-hidden"),u()})}function z(){r.promoHidden&&n.body.classList.add("promo-hidden"),A(),E(0),h(),$(),J(),T(),M(),m(),x(),S(),k(),Q()}z();
