import{p as m,S as d,r as L,f as l,a as S}from"./store-data-CwUmRqVU.js";const x=Number(new URLSearchParams(window.location.search).get("id")),s=m.find(e=>e.id===x)||m[0],a={cart:JSON.parse(localStorage.getItem(d.cart)||"[]"),wishlist:JSON.parse(localStorage.getItem(d.wishlist)||"[]"),orders:JSON.parse(localStorage.getItem(d.orders)||"[]"),user:JSON.parse(localStorage.getItem(d.user)||"null"),promoHidden:JSON.parse(localStorage.getItem(d.promoHidden)||"false"),authMode:"login",coupon:null},C={WELCOME20:{type:"percent",value:20,label:"신규회원 20%"},FREESHIP:{type:"shipping",value:3e3,label:"배송비 무료"}},i={body:document.body,promoClose:document.getElementById("promoClose"),detailContent:document.getElementById("detailContent"),relatedProducts:document.getElementById("relatedProducts"),cartCount:document.getElementById("cartCount"),wishlistCount:document.getElementById("wishlistCount"),cartItems:document.getElementById("cartItems"),wishlistItems:document.getElementById("wishlistItems"),priceSummary:document.getElementById("priceSummary"),couponInput:document.getElementById("couponInput"),authBtn:document.getElementById("authBtn"),authTitle:document.getElementById("authTitle"),authForm:document.getElementById("authForm"),authEmail:document.getElementById("authEmail"),authPassword:document.getElementById("authPassword"),authName:document.getElementById("authName"),toggleAuthMode:document.getElementById("toggleAuthMode"),checkoutForm:document.getElementById("checkoutForm"),ordersList:document.getElementById("ordersList")};function c(){localStorage.setItem(d.cart,JSON.stringify(a.cart)),localStorage.setItem(d.wishlist,JSON.stringify(a.wishlist)),localStorage.setItem(d.orders,JSON.stringify(a.orders)),localStorage.setItem(d.user,JSON.stringify(a.user)),localStorage.setItem(d.promoHidden,JSON.stringify(a.promoHidden))}function h(){return a.cart.map(e=>{const t=m.find(n=>n.id===e.productId);return t?{...e,product:t}:null}).filter(Boolean)}function w(){const t=h().reduce((M,b)=>M+b.product.price*b.quantity,0),n=t>0&&t<3e4?3e3:0;let o=0,r="-";return a.coupon?.type==="percent"&&(o=Math.floor(t*a.coupon.value/100),r=`${a.coupon.label} (-${l(o)})`),a.coupon?.type==="shipping"&&(o=Math.min(n,a.coupon.value),r=`${a.coupon.label} (-${l(o)})`),{subtotal:t,shipping:n,discount:o,total:Math.max(0,t+n-o),discountText:r}}function E(){const e=L.filter(t=>t.productId===s.id).sort((t,n)=>n.helpful-t.helpful).slice(0,3);i.detailContent.innerHTML=`
    <div class="detail-grid">
      <div>
        <div class="product-thumb" style="height:300px;font-size:3.4rem;">${s.emoji}</div>
        <div class="detail-sections">
          <article class="detail-box">
            <h4>핵심 성분</h4>
            <ul>${s.ingredients.map(t=>`<li>${t}</li>`).join("")}</ul>
          </article>
          <article class="detail-box">
            <h4>섭취 방법</h4>
            <p>${s.intake}</p>
          </article>
          <article class="detail-box">
            <h4>추천 대상</h4>
            <p>${s.target}</p>
          </article>
        </div>
      </div>
      <div>
        <span class="badge">BEST PICK</span>
        <h2 style="margin-top:8px;">${s.name}</h2>
        <p style="color:#5d7683;line-height:1.55;">${s.description}</p>
        <p>리뷰 ${s.reviews}개 · 평점 ${s.rating} / 5</p>
        <div style="display:flex;gap:8px;align-items:center;margin-top:10px;">
          <strong style="font-size:1.4rem;">${l(s.price)}</strong>
          <small style="text-decoration:line-through;color:#5d7683;">${l(s.originalPrice)}</small>
        </div>
        <div style="display:flex;gap:8px;margin-top:14px;">
          <button class="primary" data-action="addToCart" data-id="${s.id}">장바구니 담기</button>
          <button class="ghost" data-action="toggleWish" data-id="${s.id}">${a.wishlist.includes(s.id)?"찜 해제":"찜하기"}</button>
        </div>

        <div class="detail-sections">
          <article class="detail-box">
            <h4>주의사항</h4>
            <ul>${s.cautions.map(t=>`<li>${t}</li>`).join("")}</ul>
          </article>
          <article class="detail-box">
            <h4>자주 묻는 질문</h4>
            <ul>${s.faq.map(t=>`<li><strong>Q.</strong> ${t.q}<br/><strong>A.</strong> ${t.a}</li>`).join("")}</ul>
          </article>
          <article class="detail-box">
            <h4>실구매 리뷰</h4>
            <ul>${e.length?e.map(t=>`<li><strong>${"★".repeat(t.score)}</strong> ${t.text} <small>(${t.user})</small></li>`).join(""):"<li>아직 등록된 리뷰가 없습니다.</li>"}</ul>
          </article>
        </div>
      </div>
    </div>
  `}function N(){const e=m.filter(t=>t.id!==s.id).slice(0,4);i.relatedProducts.innerHTML=e.map(t=>`<article class="product-card"><div class="product-thumb">${t.emoji}</div><div class="product-meta"><h4>${t.name}</h4><p>⭐ ${t.rating} (${t.reviews})</p></div><div class="price-row"><span>${l(t.price)}</span></div><a class="text-btn link-btn" href="detail.html?id=${t.id}">상세보기</a></article>`).join("")}function u(){const e=h();i.cartCount.textContent=a.cart.reduce((n,o)=>n+o.quantity,0),i.cartItems.innerHTML=e.length===0?'<p class="empty">장바구니가 비어 있습니다.</p>':e.map(n=>`<article class="cart-item"><strong>${n.product.name}</strong><p>${l(n.product.price)} x ${n.quantity}</p><div style="display:flex;justify-content:space-between;align-items:center;gap:8px;"><div class="qty-controls"><button data-action="decreaseQty" data-id="${n.product.id}">-</button><span>${n.quantity}</span><button data-action="increaseQty" data-id="${n.product.id}">+</button></div><button class="text-btn" data-action="removeFromCart" data-id="${n.product.id}">삭제</button></div></article>`).join("");const t=w();i.priceSummary.innerHTML=`<div>상품금액 <strong>${l(t.subtotal)}</strong></div><div>배송비 <strong>${l(t.shipping)}</strong></div><div>할인 <strong>${t.discount?"-":""}${l(t.discount)}</strong></div><div style="color:#5d7683;font-size:0.82rem">${t.discountText}</div><div style="font-size:1.04rem">총 결제금액 <strong>${l(t.total)}</strong></div>`}function B(){const e=m.filter(t=>a.wishlist.includes(t.id));i.wishlistCount.textContent=a.wishlist.length,i.wishlistItems.innerHTML=e.length===0?'<p class="empty">찜한 상품이 없습니다.</p>':e.map(t=>`<article class="wish-item"><strong>${t.name}</strong><p>${l(t.price)}</p><div style="display:flex;gap:8px;"><button class="primary" data-action="addToCart" data-id="${t.id}">장바구니 담기</button><button class="text-btn" data-action="toggleWish" data-id="${t.id}">삭제</button></div></article>`).join("")}function v(){if(!a.orders.length){i.ordersList.innerHTML='<p class="empty">아직 주문 내역이 없습니다.</p>';return}i.ordersList.innerHTML=a.orders.slice().reverse().map(e=>`<article class="order-item"><strong>${e.orderId} · ${e.date}</strong><p>${e.items.map(t=>`${t.name} x ${t.quantity}`).join(", ")}</p><p>결제수단: ${S(e.paymentMethod)} · 총액: ${l(e.total)}</p></article>`).join("")}function $(){i.authBtn.textContent=a.user?`${a.user.name}님`:"로그인"}function I(e,t=1){const n=m.find(r=>r.id===e);if(!n)return;const o=a.cart.find(r=>r.productId===e);o?o.quantity=Math.min(o.quantity+t,n.stock):a.cart.push({productId:e,quantity:Math.min(t,n.stock)}),u(),c()}function k(e){a.wishlist=a.wishlist.includes(e)?a.wishlist.filter(t=>t!==e):[...a.wishlist,e],B(),E(),c()}function f(e){document.getElementById(e).classList.add("open")}function g(e){document.getElementById(e).classList.remove("open")}function p(e){document.getElementById(e).classList.add("open")}function y(e){document.getElementById(e).classList.remove("open")}function D(){return a.user?!0:(p("authModal"),!1)}function T(){document.addEventListener("click",e=>{const t=e.target,n=t.dataset.action;if(n==="addToCart"&&(I(Number(t.dataset.id),1),f("cartDrawer")),n==="toggleWish"&&k(Number(t.dataset.id)),n==="removeFromCart"&&(a.cart=a.cart.filter(o=>o.productId!==Number(t.dataset.id)),u(),c()),n==="increaseQty"&&I(Number(t.dataset.id),1),n==="decreaseQty"){const o=a.cart.find(r=>r.productId===Number(t.dataset.id));if(!o)return;o.quantity-=1,o.quantity<=0&&(a.cart=a.cart.filter(r=>r.productId!==Number(t.dataset.id))),u(),c()}t.dataset.close&&(t.dataset.close.includes("Drawer")?g(t.dataset.close):y(t.dataset.close)),t.id==="cartBtn"&&f("cartDrawer"),t.id==="wishlistBtn"&&f("wishlistDrawer"),t.id==="ordersBtn"&&(v(),p("ordersModal")),t.id==="authBtn"&&(a.user&&confirm("로그아웃 하시겠습니까?")?(a.user=null,c(),$()):a.user||p("authModal"))}),document.addEventListener("click",e=>{const t=e.target.closest(".drawer"),n=e.target.closest("#cartBtn, #wishlistBtn");!t&&!n&&(g("cartDrawer"),g("wishlistDrawer"))}),document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("click",t=>{t.target===e&&e.classList.remove("open")})}),document.getElementById("applyCouponBtn").addEventListener("click",()=>{const e=i.couponInput.value.trim().toUpperCase(),t=C[e];if(!t)return alert("사용할 수 없는 쿠폰입니다.");a.coupon=t,u()}),document.getElementById("checkoutBtn").addEventListener("click",()=>{if(!h().length)return alert("장바구니가 비어 있습니다.");D()&&p("checkoutModal")}),i.authForm.addEventListener("submit",e=>{e.preventDefault();const t=i.authEmail.value.trim(),n=i.authPassword.value.trim(),o=i.authName.value.trim();if(!(!t||!n)){if(a.authMode==="signup"){if(!o)return alert("이름을 입력해주세요.");a.user={email:t,name:o}}else a.user={email:t,name:t.split("@")[0]};c(),$(),y("authModal"),i.authForm.reset()}}),i.toggleAuthMode.addEventListener("click",()=>{a.authMode=a.authMode==="login"?"signup":"login";const e=a.authMode==="signup";i.authTitle.textContent=e?"회원가입":"로그인",i.authName.classList.toggle("hidden",!e),i.toggleAuthMode.textContent=e?"로그인 하기":"회원가입 하기"}),i.checkoutForm.addEventListener("submit",e=>{e.preventDefault();const t=Object.fromEntries(new FormData(i.checkoutForm).entries());if(!t.paymentMethod)return alert("결제수단을 선택해주세요.");const n=h();if(!n.length)return;const o=w();a.orders.push({orderId:`SL-${Date.now().toString().slice(-8)}`,date:new Date().toLocaleDateString("ko-KR"),paymentMethod:t.paymentMethod,items:n.map(r=>({name:r.product.name,quantity:r.quantity})),total:o.total}),a.cart=[],a.coupon=null,c(),u(),v(),y("checkoutModal"),g("cartDrawer"),p("ordersModal"),i.checkoutForm.reset()}),i.promoClose.addEventListener("click",()=>{a.promoHidden=!0,i.body.classList.add("promo-hidden"),c()})}function q(){a.promoHidden&&i.body.classList.add("promo-hidden"),E(),N(),u(),B(),v(),$(),T()}q();
