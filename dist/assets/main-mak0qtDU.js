import{S as c,f as d,r as v,p,a as F}from"./store-data-CwUmRqVU.js";const r={cart:JSON.parse(localStorage.getItem(c.cart)||"[]"),wishlist:JSON.parse(localStorage.getItem(c.wishlist)||"[]"),orders:JSON.parse(localStorage.getItem(c.orders)||"[]"),user:JSON.parse(localStorage.getItem(c.user)||"null"),promoHidden:JSON.parse(localStorage.getItem(c.promoHidden)||"false"),authMode:"login",coupon:null,reviewFilter:"all",reviewHighOnly:!1},k={WELCOME20:{type:"percent",value:20,label:"신규회원 20%"},FREESHIP:{type:"shipping",value:3e3,label:"배송비 무료"}},C=[{key:"all",label:"전체 리뷰"},{key:"5",label:"5점 리뷰"},{key:"4",label:"4점 이상"},{key:"3",label:"3점 이하"}],a={body:document.body,promoClose:document.getElementById("promoClose"),productGrid:document.getElementById("productGrid"),searchInput:document.getElementById("searchInput"),priceFilter:document.getElementById("priceFilter"),sortFilter:document.getElementById("sortFilter"),cartCount:document.getElementById("cartCount"),wishlistCount:document.getElementById("wishlistCount"),cartItems:document.getElementById("cartItems"),wishlistItems:document.getElementById("wishlistItems"),priceSummary:document.getElementById("priceSummary"),couponInput:document.getElementById("couponInput"),reviewSummary:document.getElementById("reviewSummary"),reviewFilterRow:document.getElementById("reviewFilterRow"),reviewCards:document.getElementById("reviewCards"),reviewHighBtn:document.getElementById("reviewHighBtn"),authBtn:document.getElementById("authBtn"),authTitle:document.getElementById("authTitle"),authForm:document.getElementById("authForm"),authEmail:document.getElementById("authEmail"),authPassword:document.getElementById("authPassword"),authName:document.getElementById("authName"),toggleAuthMode:document.getElementById("toggleAuthMode"),checkoutForm:document.getElementById("checkoutForm"),ordersList:document.getElementById("ordersList")};function l(){localStorage.setItem(c.cart,JSON.stringify(r.cart)),localStorage.setItem(c.wishlist,JSON.stringify(r.wishlist)),localStorage.setItem(c.orders,JSON.stringify(r.orders)),localStorage.setItem(c.user,JSON.stringify(r.user)),localStorage.setItem(c.promoHidden,JSON.stringify(r.promoHidden))}function $(){return r.cart.map(e=>{const t=p.find(i=>i.id===e.productId);return t?{...e,product:t}:null}).filter(Boolean)}function L(){const t=$().reduce((s,u)=>s+u.product.price*u.quantity,0),i=t>0&&t<3e4?3e3:0;let n=0,o="-";return r.coupon?.type==="percent"&&(n=Math.floor(t*r.coupon.value/100),o=`${r.coupon.label} (-${d(n)})`),r.coupon?.type==="shipping"&&(n=Math.min(i,r.coupon.value),o=`${r.coupon.label} (-${d(n)})`),{subtotal:t,shipping:i,discount:n,total:Math.max(0,t+i-n),discountText:o}}function H(){const e=a.searchInput.value.trim().toLowerCase(),t=a.priceFilter.value,i=a.sortFilter.value;let n=[...p];if(e&&(n=n.filter(o=>o.name.toLowerCase().includes(e)||o.description.toLowerCase().includes(e)||o.ingredients.some(s=>s.toLowerCase().includes(e)))),t!=="all"){const[o,s]=t.split("-").map(Number);n=n.filter(u=>u.price>=o&&u.price<=s)}return i==="popular"&&n.sort((o,s)=>s.popularScore-o.popularScore),i==="newest"&&n.sort((o,s)=>new Date(s.releaseDate)-new Date(o.releaseDate)),i==="priceAsc"&&n.sort((o,s)=>o.price-s.price),i==="priceDesc"&&n.sort((o,s)=>s.price-o.price),n}function g(){const e=H();if(!e.length){a.productGrid.innerHTML='<p class="empty">조건에 맞는 상품이 없습니다.</p>';return}a.productGrid.innerHTML=e.map(t=>{const i=r.wishlist.includes(t.id),n=Math.round((1-t.price/t.originalPrice)*100),o=t.stock<=30;return`
      <article class="product-card">
        <div class="product-thumb">${t.emoji}</div>
        <div class="product-meta">
          <span class="badge ${o?"low-stock":""}">${o?`재고 ${t.stock}개`:`할인 ${n}%`}</span>
          <h4>${t.name}</h4>
          <p>⭐ ${t.rating} (${t.reviews}) · ${t.ingredients.slice(0,2).join("/")}</p>
        </div>
        <div class="price-row">
          <span>${d(t.price)}</span>
          <small style="color:#5d7683;text-decoration:line-through">${d(t.originalPrice)}</small>
        </div>
        <div class="card-actions">
          <button class="primary" data-action="addToCart" data-id="${t.id}">담기</button>
          <button class="ghost" data-action="toggleWish" data-id="${t.id}">${i?"♥":"♡"}</button>
        </div>
        <a class="text-btn link-btn" href="pages/detail.html?id=${t.id}">상세보기</a>
      </article>`}).join("")}function D(){let e=[...v];return r.reviewFilter==="5"&&(e=e.filter(t=>t.score===5)),r.reviewFilter==="4"&&(e=e.filter(t=>t.score>=4)),r.reviewFilter==="3"&&(e=e.filter(t=>t.score<=3)),r.reviewHighOnly&&(e=e.filter(t=>t.score>=5)),e.sort((t,i)=>i.helpful-t.helpful)}function N(){const e={5:0,4:0,3:0,2:0,1:0};v.forEach(n=>e[n.score]+=1);const t=v.length,i=(v.reduce((n,o)=>n+o.score,0)/t).toFixed(1);a.reviewSummary.innerHTML=`
    <div class="review-score">
      <strong>${i}</strong>
      <div>${"★".repeat(Math.round(Number(i)))}${"☆".repeat(5-Math.round(Number(i)))}</div>
      <small>총 ${t}개 리뷰</small>
    </div>
    <div class="review-bars">
      ${[5,4,3,2,1].map(n=>{const o=e[n],s=t?Math.round(o/t*100):0;return`<div class="review-bar"><span>${n}점</span><div class="review-bar-track"><div class="review-bar-fill" style="width:${s}%"></div></div><span>${o}</span></div>`}).join("")}
    </div>`}function M(){a.reviewFilterRow.innerHTML=C.map(e=>`<button class="review-chip ${r.reviewFilter===e.key?"active":""}" data-review-filter="${e.key}">${e.label}</button>`).join("")}function b(){const e=D();if(!e.length){a.reviewCards.innerHTML='<p class="empty">선택된 조건의 리뷰가 없습니다.</p>';return}a.reviewCards.innerHTML=e.map(t=>{const i=p.find(n=>n.id===t.productId);return`<article class="review-card">
        <div class="review-card-head"><span>${t.user} · ${t.date}</span><strong>${"★".repeat(t.score)}${"☆".repeat(5-t.score)}</strong></div>
        <p>${t.text}</p>
        <small style="color:#5d7683">구매 옵션: ${t.option}</small>
        <div class="review-foot"><span>도움돼요 ${t.helpful}</span><a class="text-btn link-btn" href="pages/detail.html?id=${t.productId}">${i?.name||"상품"} 보기</a></div>
      </article>`}).join("")}function m(){const e=$();a.cartCount.textContent=r.cart.reduce((i,n)=>i+n.quantity,0),a.cartItems.innerHTML=e.length===0?'<p class="empty">장바구니가 비어 있습니다.</p>':e.map(i=>`<article class="cart-item"><strong>${i.product.name}</strong><p>${d(i.product.price)} x ${i.quantity}</p><div style="display:flex;justify-content:space-between;align-items:center;gap:8px;"><div class="qty-controls"><button data-action="decreaseQty" data-id="${i.product.id}">-</button><span>${i.quantity}</span><button data-action="increaseQty" data-id="${i.product.id}">+</button></div><button class="text-btn" data-action="removeFromCart" data-id="${i.product.id}">삭제</button></div></article>`).join("");const t=L();a.priceSummary.innerHTML=`<div>상품금액 <strong>${d(t.subtotal)}</strong></div><div>배송비 <strong>${d(t.shipping)}</strong></div><div>할인 <strong>${t.discount?"-":""}${d(t.discount)}</strong></div><div style="color:#5d7683;font-size:0.82rem">${t.discountText}</div><div style="font-size:1.04rem">총 결제금액 <strong>${d(t.total)}</strong></div>`}function S(){const e=p.filter(t=>r.wishlist.includes(t.id));a.wishlistCount.textContent=r.wishlist.length,a.wishlistItems.innerHTML=e.length===0?'<p class="empty">찜한 상품이 없습니다.</p>':e.map(t=>`<article class="wish-item"><strong>${t.name}</strong><p>${d(t.price)}</p><div style="display:flex;gap:8px;"><button class="primary" data-action="addToCart" data-id="${t.id}">장바구니 담기</button><button class="text-btn" data-action="toggleWish" data-id="${t.id}">삭제</button></div></article>`).join("")}function B(){if(!r.orders.length){a.ordersList.innerHTML='<p class="empty">아직 주문 내역이 없습니다.</p>';return}a.ordersList.innerHTML=r.orders.slice().reverse().map(e=>`<article class="order-item"><strong>${e.orderId} · ${e.date}</strong><p>${e.items.map(t=>`${t.name} x ${t.quantity}`).join(", ")}</p><p>결제수단: ${F(e.paymentMethod)} · 총액: ${d(e.total)}</p><button class="ghost" data-action="reorder" data-order-id="${e.orderId}">재주문</button></article>`).join("")}function E(){a.authBtn.textContent=r.user?`${r.user.name}님`:"로그인"}function I(e,t=1){const i=p.find(o=>o.id===e);if(!i)return;const n=r.cart.find(o=>o.productId===e);n?n.quantity=Math.min(n.quantity+t,i.stock):r.cart.push({productId:e,quantity:Math.min(t,i.stock)}),m(),l()}function x(e){r.wishlist=r.wishlist.includes(e)?r.wishlist.filter(t=>t!==e):[...r.wishlist,e],g(),S(),l()}function f(e){document.getElementById(e).classList.add("open")}function w(e){document.getElementById(e).classList.remove("open")}function y(e){document.getElementById(e).classList.remove("open")}function h(e){document.getElementById(e).classList.add("open")}function T(){return r.user?!0:(h("authModal"),!1)}function O(e){const t=$();if(!t.length)return;const i=L(),n={orderId:`SL-${Date.now().toString().slice(-8)}`,date:new Date().toLocaleDateString("ko-KR"),paymentMethod:e.paymentMethod,items:t.map(o=>({name:o.product.name,quantity:o.quantity})),total:i.total};r.orders.push(n),r.cart=[],r.coupon=null,l(),m(),B(),y("checkoutModal"),w("cartDrawer"),h("ordersModal")}function q(){[a.searchInput,a.priceFilter,a.sortFilter].forEach(e=>{e.addEventListener("input",g),e.addEventListener("change",g)}),a.reviewFilterRow.addEventListener("click",e=>{const t=e.target.closest("[data-review-filter]");t&&(r.reviewFilter=t.dataset.reviewFilter,M(),b())}),a.reviewHighBtn.addEventListener("click",()=>{r.reviewHighOnly=!r.reviewHighOnly,a.reviewHighBtn.textContent=r.reviewHighOnly?"전체 리뷰 보기":"평점 4.5 이상만 보기",b()}),document.addEventListener("click",e=>{const t=e.target,i=t.dataset.action;if(i==="addToCart"&&(I(Number(t.dataset.id),1),f("cartDrawer")),i==="toggleWish"&&x(Number(t.dataset.id)),i==="removeFromCart"&&(r.cart=r.cart.filter(n=>n.productId!==Number(t.dataset.id)),m(),l()),i==="increaseQty"&&I(Number(t.dataset.id),1),i==="decreaseQty"){const n=r.cart.find(o=>o.productId===Number(t.dataset.id));if(!n)return;n.quantity-=1,n.quantity<=0&&(r.cart=r.cart.filter(o=>o.productId!==Number(t.dataset.id))),m(),l()}if(i==="reorder"){const n=r.orders.find(o=>o.orderId===t.dataset.orderId);if(!n)return;n.items.forEach(o=>{const s=p.find(u=>u.name===o.name);s&&I(s.id,o.quantity)}),y("ordersModal"),f("cartDrawer")}t.dataset.close&&(t.dataset.close.includes("Drawer")?w(t.dataset.close):y(t.dataset.close)),t.id==="cartBtn"&&f("cartDrawer"),t.id==="wishlistBtn"&&f("wishlistDrawer"),t.id==="ordersBtn"&&(B(),h("ordersModal")),(t.id==="heroShopNow"||t.id==="heroBestSeller")&&(t.id==="heroBestSeller"&&(a.sortFilter.value="popular",g()),document.getElementById("productSection").scrollIntoView({behavior:"smooth"})),t.id==="authBtn"&&(r.user&&confirm("로그아웃 하시겠습니까?")?(r.user=null,l(),E()):r.user||h("authModal"))}),document.addEventListener("click",e=>{const t=e.target.closest(".drawer"),i=e.target.closest("#cartBtn, #wishlistBtn");!t&&!i&&(w("cartDrawer"),w("wishlistDrawer"))}),document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("click",t=>{t.target===e&&e.classList.remove("open")})}),document.getElementById("applyCouponBtn").addEventListener("click",()=>{const e=a.couponInput.value.trim().toUpperCase(),t=k[e];if(!t){alert("사용할 수 없는 쿠폰입니다.");return}r.coupon=t,m()}),document.getElementById("checkoutBtn").addEventListener("click",()=>{if(!$().length){alert("장바구니가 비어 있습니다.");return}T()&&h("checkoutModal")}),a.authForm.addEventListener("submit",e=>{e.preventDefault();const t=a.authEmail.value.trim(),i=a.authPassword.value.trim(),n=a.authName.value.trim();if(!(!t||!i)){if(r.authMode==="signup"){if(!n)return alert("이름을 입력해주세요.");r.user={email:t,name:n}}else r.user={email:t,name:t.split("@")[0]};l(),E(),y("authModal"),a.authForm.reset()}}),a.toggleAuthMode.addEventListener("click",()=>{r.authMode=r.authMode==="login"?"signup":"login";const e=r.authMode==="signup";a.authTitle.textContent=e?"회원가입":"로그인",a.authName.classList.toggle("hidden",!e),a.toggleAuthMode.textContent=e?"로그인 하기":"회원가입 하기"}),a.checkoutForm.addEventListener("submit",e=>{e.preventDefault();const t=Object.fromEntries(new FormData(a.checkoutForm).entries());if(!t.paymentMethod)return alert("결제수단을 선택해주세요.");O(t),a.checkoutForm.reset()}),a.promoClose.addEventListener("click",()=>{r.promoHidden=!0,a.body.classList.add("promo-hidden"),l()})}function R(){r.promoHidden&&a.body.classList.add("promo-hidden"),g(),N(),M(),b(),m(),S(),B(),E(),q()}R();
