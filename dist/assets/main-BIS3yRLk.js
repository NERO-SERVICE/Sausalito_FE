import{S as d,r as v,p,f as c,a as F,b as k,c as C}from"./store-data-nN5M5vzU.js";const r={cart:JSON.parse(localStorage.getItem(d.cart)||"[]"),wishlist:JSON.parse(localStorage.getItem(d.wishlist)||"[]"),orders:JSON.parse(localStorage.getItem(d.orders)||"[]"),user:JSON.parse(localStorage.getItem(d.user)||"null"),promoHidden:JSON.parse(localStorage.getItem(d.promoHidden)||"false"),authMode:"login",coupon:null,reviewFilter:"all",reviewHighOnly:!1},H={WELCOME20:{type:"percent",value:20,label:"신규회원 20%"},FREESHIP:{type:"shipping",value:3e3,label:"배송비 무료"}},D=[{key:"all",label:"전체 리뷰"},{key:"5",label:"5점 리뷰"},{key:"4",label:"4점 이상"},{key:"3",label:"3점 이하"}],o={body:document.body,promoClose:document.getElementById("promoClose"),productGrid:document.getElementById("productGrid"),searchInput:document.getElementById("searchInput"),priceFilter:document.getElementById("priceFilter"),sortFilter:document.getElementById("sortFilter"),cartCount:document.getElementById("cartCount"),wishlistCount:document.getElementById("wishlistCount"),cartItems:document.getElementById("cartItems"),wishlistItems:document.getElementById("wishlistItems"),priceSummary:document.getElementById("priceSummary"),couponInput:document.getElementById("couponInput"),reviewSummary:document.getElementById("reviewSummary"),reviewFilterRow:document.getElementById("reviewFilterRow"),reviewCards:document.getElementById("reviewCards"),reviewHighBtn:document.getElementById("reviewHighBtn"),authBtn:document.getElementById("authBtn"),authTitle:document.getElementById("authTitle"),authForm:document.getElementById("authForm"),authEmail:document.getElementById("authEmail"),authPassword:document.getElementById("authPassword"),authName:document.getElementById("authName"),toggleAuthMode:document.getElementById("toggleAuthMode"),checkoutForm:document.getElementById("checkoutForm"),ordersList:document.getElementById("ordersList")};function u(){localStorage.setItem(d.cart,JSON.stringify(r.cart)),localStorage.setItem(d.wishlist,JSON.stringify(r.wishlist)),localStorage.setItem(d.orders,JSON.stringify(r.orders)),localStorage.setItem(d.user,JSON.stringify(r.user)),localStorage.setItem(d.promoHidden,JSON.stringify(r.promoHidden))}function I(){return r.cart.map(t=>{const e=p.find(i=>i.id===t.productId);return e?{...t,product:e}:null}).filter(Boolean)}function L(){const e=I().reduce((s,l)=>s+l.product.price*l.quantity,0),i=e>0&&e<3e4?3e3:0;let n=0,a="-";return r.coupon?.type==="percent"&&(n=Math.floor(e*r.coupon.value/100),a=`${r.coupon.label} (-${c(n)})`),r.coupon?.type==="shipping"&&(n=Math.min(i,r.coupon.value),a=`${r.coupon.label} (-${c(n)})`),{subtotal:e,shipping:i,discount:n,total:Math.max(0,e+i-n),discountText:a}}function N(){const t=o.searchInput.value.trim().toLowerCase(),e=o.priceFilter.value,i=o.sortFilter.value;let n=[...p];if(t&&(n=n.filter(a=>a.name.toLowerCase().includes(t)||a.description.toLowerCase().includes(t)||a.ingredients.some(s=>s.toLowerCase().includes(t)))),e!=="all"){const[a,s]=e.split("-").map(Number);n=n.filter(l=>l.price>=a&&l.price<=s)}return i==="popular"&&n.sort((a,s)=>s.popularScore-a.popularScore),i==="newest"&&n.sort((a,s)=>new Date(s.releaseDate)-new Date(a.releaseDate)),i==="priceAsc"&&n.sort((a,s)=>a.price-s.price),i==="priceDesc"&&n.sort((a,s)=>s.price-a.price),n}function g(){const t=N();if(!t.length){o.productGrid.innerHTML='<p class="empty">조건에 맞는 상품이 없습니다.</p>';return}o.productGrid.innerHTML=t.map(e=>x(e,`pages/detail.html?id=${e.id}`)).join("")}function x(t,e){const i=Math.round((1-t.price/t.originalPrice)*100),n=t.reviews.toLocaleString("ko-KR"),a=k(t.image),s=C(t.image);return`
    <a class="product-card product-card-link" href="${e}" aria-label="${t.name} 상세페이지로 이동">
      <div class="product-thumb">
        <div class="product-badges">
          ${(t.badges||[]).slice(0,2).map(l=>`<span class="product-badge">${l}</span>`).join("")}
        </div>
        <img
          src="${a}"
          data-fallback="${s}"
          alt="${t.name}"
          loading="lazy"
          onerror="if(this.dataset.fallback && this.src !== this.dataset.fallback){this.src=this.dataset.fallback;}"
        />
      </div>
      <div class="product-meta">
        <h4>${t.name}</h4>
        <p>${t.oneLine||t.description}</p>
      </div>
      <div class="price-stack">
        <small class="old-price">${c(t.originalPrice)}</small>
        <div class="new-price-row">
          <span class="discount-rate">${i}%</span>
          <strong class="new-price">${c(t.price)}</strong>
        </div>
      </div>
      <div class="review-count">리뷰 (${n})</div>
    </a>
  `}function O(){let t=[...v];return r.reviewFilter==="5"&&(t=t.filter(e=>e.score===5)),r.reviewFilter==="4"&&(t=t.filter(e=>e.score>=4)),r.reviewFilter==="3"&&(t=t.filter(e=>e.score<=3)),r.reviewHighOnly&&(t=t.filter(e=>e.score>=5)),t.sort((e,i)=>i.helpful-e.helpful)}function T(){const t={5:0,4:0,3:0,2:0,1:0};v.forEach(n=>t[n.score]+=1);const e=v.length,i=(v.reduce((n,a)=>n+a.score,0)/e).toFixed(1);o.reviewSummary.innerHTML=`
    <div class="review-score">
      <strong>${i}</strong>
      <div>${"★".repeat(Math.round(Number(i)))}${"☆".repeat(5-Math.round(Number(i)))}</div>
      <small>총 ${e}개 리뷰</small>
    </div>
    <div class="review-bars">
      ${[5,4,3,2,1].map(n=>{const a=t[n],s=e?Math.round(a/e*100):0;return`<div class="review-bar"><span>${n}점</span><div class="review-bar-track"><div class="review-bar-fill" style="width:${s}%"></div></div><span>${a}</span></div>`}).join("")}
    </div>`}function M(){o.reviewFilterRow.innerHTML=D.map(t=>`<button class="review-chip ${r.reviewFilter===t.key?"active":""}" data-review-filter="${t.key}">${t.label}</button>`).join("")}function $(){const t=O();if(!t.length){o.reviewCards.innerHTML='<p class="empty">선택된 조건의 리뷰가 없습니다.</p>';return}o.reviewCards.innerHTML=t.map(e=>{const i=p.find(n=>n.id===e.productId);return`<article class="review-card">
        <div class="review-card-head"><span>${e.user} · ${e.date}</span><strong>${"★".repeat(e.score)}${"☆".repeat(5-e.score)}</strong></div>
        <p>${e.text}</p>
        <small style="color:#5d7683">구매 옵션: ${e.option}</small>
        <div class="review-foot"><span>도움돼요 ${e.helpful}</span><a class="text-btn link-btn" href="pages/detail.html?id=${e.productId}">${i?.name||"상품"} 보기</a></div>
      </article>`}).join("")}function m(){const t=I();o.cartCount.textContent=r.cart.reduce((i,n)=>i+n.quantity,0),o.cartItems.innerHTML=t.length===0?'<p class="empty">장바구니가 비어 있습니다.</p>':t.map(i=>`<article class="cart-item"><strong>${i.product.name}</strong><p>${c(i.product.price)} x ${i.quantity}</p><div style="display:flex;justify-content:space-between;align-items:center;gap:8px;"><div class="qty-controls"><button data-action="decreaseQty" data-id="${i.product.id}">-</button><span>${i.quantity}</span><button data-action="increaseQty" data-id="${i.product.id}">+</button></div><button class="text-btn" data-action="removeFromCart" data-id="${i.product.id}">삭제</button></div></article>`).join("");const e=L();o.priceSummary.innerHTML=`<div>상품금액 <strong>${c(e.subtotal)}</strong></div><div>배송비 <strong>${c(e.shipping)}</strong></div><div>할인 <strong>${e.discount?"-":""}${c(e.discount)}</strong></div><div style="color:#5d7683;font-size:0.82rem">${e.discountText}</div><div style="font-size:1.04rem">총 결제금액 <strong>${c(e.total)}</strong></div>`}function S(){const t=p.filter(e=>r.wishlist.includes(e.id));o.wishlistCount.textContent=r.wishlist.length,o.wishlistItems.innerHTML=t.length===0?'<p class="empty">찜한 상품이 없습니다.</p>':t.map(e=>`<article class="wish-item"><strong>${e.name}</strong><p>${c(e.price)}</p><div style="display:flex;gap:8px;"><button class="primary" data-action="addToCart" data-id="${e.id}">장바구니 담기</button><button class="text-btn" data-action="toggleWish" data-id="${e.id}">삭제</button></div></article>`).join("")}function B(){if(!r.orders.length){o.ordersList.innerHTML='<p class="empty">아직 주문 내역이 없습니다.</p>';return}o.ordersList.innerHTML=r.orders.slice().reverse().map(t=>`<article class="order-item"><strong>${t.orderId} · ${t.date}</strong><p>${t.items.map(e=>`${e.name} x ${e.quantity}`).join(", ")}</p><p>결제수단: ${F(t.paymentMethod)} · 총액: ${c(t.total)}</p><button class="ghost" data-action="reorder" data-order-id="${t.orderId}">재주문</button></article>`).join("")}function E(){o.authBtn.textContent=r.user?`${r.user.name}님`:"로그인"}function b(t,e=1){const i=p.find(a=>a.id===t);if(!i)return;const n=r.cart.find(a=>a.productId===t);n?n.quantity=Math.min(n.quantity+e,i.stock):r.cart.push({productId:t,quantity:Math.min(e,i.stock)}),m(),u()}function q(t){r.wishlist=r.wishlist.includes(t)?r.wishlist.filter(e=>e!==t):[...r.wishlist,t],g(),S(),u()}function f(t){document.getElementById(t).classList.add("open")}function w(t){document.getElementById(t).classList.remove("open")}function y(t){document.getElementById(t).classList.remove("open")}function h(t){document.getElementById(t).classList.add("open")}function R(){return r.user?!0:(h("authModal"),!1)}function j(t){const e=I();if(!e.length)return;const i=L(),n={orderId:`SL-${Date.now().toString().slice(-8)}`,date:new Date().toLocaleDateString("ko-KR"),paymentMethod:t.paymentMethod,items:e.map(a=>({name:a.product.name,quantity:a.quantity})),total:i.total};r.orders.push(n),r.cart=[],r.coupon=null,u(),m(),B(),y("checkoutModal"),w("cartDrawer"),h("ordersModal")}function P(){[o.searchInput,o.priceFilter,o.sortFilter].forEach(t=>{t.addEventListener("input",g),t.addEventListener("change",g)}),o.reviewFilterRow.addEventListener("click",t=>{const e=t.target.closest("[data-review-filter]");e&&(r.reviewFilter=e.dataset.reviewFilter,M(),$())}),o.reviewHighBtn.addEventListener("click",()=>{r.reviewHighOnly=!r.reviewHighOnly,o.reviewHighBtn.textContent=r.reviewHighOnly?"전체 리뷰 보기":"평점 4.5 이상만 보기",$()}),document.addEventListener("click",t=>{const e=t.target,i=e.dataset.action;if(i==="addToCart"&&(b(Number(e.dataset.id),1),f("cartDrawer")),i==="toggleWish"&&q(Number(e.dataset.id)),i==="removeFromCart"&&(r.cart=r.cart.filter(n=>n.productId!==Number(e.dataset.id)),m(),u()),i==="increaseQty"&&b(Number(e.dataset.id),1),i==="decreaseQty"){const n=r.cart.find(a=>a.productId===Number(e.dataset.id));if(!n)return;n.quantity-=1,n.quantity<=0&&(r.cart=r.cart.filter(a=>a.productId!==Number(e.dataset.id))),m(),u()}if(i==="reorder"){const n=r.orders.find(a=>a.orderId===e.dataset.orderId);if(!n)return;n.items.forEach(a=>{const s=p.find(l=>l.name===a.name);s&&b(s.id,a.quantity)}),y("ordersModal"),f("cartDrawer")}e.dataset.close&&(e.dataset.close.includes("Drawer")?w(e.dataset.close):y(e.dataset.close)),e.id==="cartBtn"&&f("cartDrawer"),e.id==="wishlistBtn"&&f("wishlistDrawer"),e.id==="ordersBtn"&&(B(),h("ordersModal")),(e.id==="heroShopNow"||e.id==="heroBestSeller")&&(e.id==="heroBestSeller"&&(o.sortFilter.value="popular",g()),document.getElementById("productSection").scrollIntoView({behavior:"smooth"})),e.id==="authBtn"&&(r.user&&confirm("로그아웃 하시겠습니까?")?(r.user=null,u(),E()):r.user||h("authModal"))}),document.addEventListener("click",t=>{const e=t.target.closest(".drawer"),i=t.target.closest("#cartBtn, #wishlistBtn");!e&&!i&&(w("cartDrawer"),w("wishlistDrawer"))}),document.querySelectorAll(".modal").forEach(t=>{t.addEventListener("click",e=>{e.target===t&&t.classList.remove("open")})}),document.getElementById("applyCouponBtn").addEventListener("click",()=>{const t=o.couponInput.value.trim().toUpperCase(),e=H[t];if(!e){alert("사용할 수 없는 쿠폰입니다.");return}r.coupon=e,m()}),document.getElementById("checkoutBtn").addEventListener("click",()=>{if(!I().length){alert("장바구니가 비어 있습니다.");return}R()&&h("checkoutModal")}),o.authForm.addEventListener("submit",t=>{t.preventDefault();const e=o.authEmail.value.trim(),i=o.authPassword.value.trim(),n=o.authName.value.trim();if(!(!e||!i)){if(r.authMode==="signup"){if(!n)return alert("이름을 입력해주세요.");r.user={email:e,name:n}}else r.user={email:e,name:e.split("@")[0]};u(),E(),y("authModal"),o.authForm.reset()}}),o.toggleAuthMode.addEventListener("click",()=>{r.authMode=r.authMode==="login"?"signup":"login";const t=r.authMode==="signup";o.authTitle.textContent=t?"회원가입":"로그인",o.authName.classList.toggle("hidden",!t),o.toggleAuthMode.textContent=t?"로그인 하기":"회원가입 하기"}),o.checkoutForm.addEventListener("submit",t=>{t.preventDefault();const e=Object.fromEntries(new FormData(o.checkoutForm).entries());if(!e.paymentMethod)return alert("결제수단을 선택해주세요.");j(e),o.checkoutForm.reset()}),o.promoClose.addEventListener("click",()=>{r.promoHidden=!0,o.body.classList.add("promo-hidden"),u()})}function J(){r.promoHidden&&o.body.classList.add("promo-hidden"),g(),T(),M(),$(),m(),S(),B(),E(),P()}J();
