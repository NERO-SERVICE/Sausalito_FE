import{S as c,r as y,p,f as l,a as D,b as H,c as N}from"./store-data-CpyAMhlY.js";const r={cart:JSON.parse(localStorage.getItem(c.cart)||"[]"),wishlist:JSON.parse(localStorage.getItem(c.wishlist)||"[]"),orders:JSON.parse(localStorage.getItem(c.orders)||"[]"),user:JSON.parse(localStorage.getItem(c.user)||"null"),promoHidden:JSON.parse(localStorage.getItem(c.promoHidden)||"false"),authMode:"login",coupon:null,reviewFilter:"all",reviewHighOnly:!1,monthlyIndex:0},E=[{subtitle:"APRIL CURATION",title:`이달의 아이템 #1
데일리 멀티 루틴`,description:"활력 밸런스를 위한 멀티비타민 큐레이션. 매일 꾸준히 시작해보세요.",promoText:`이번 달 추천
기초 영양 루틴`,image:"/dist/img/products/dummy1.png",detailId:1},{subtitle:"APRIL CURATION",title:`이달의 아이템 #2
혈행 케어 스페셜`,description:"오메가3 중심으로 구성한 집중 케어. 바쁜 일상 속 건강 관리에 적합합니다.",promoText:`지금 가장 인기 있는
혈행 집중 솔루션`,image:"/dist/img/products/dummy2.png",detailId:2},{subtitle:"APRIL CURATION",title:`이달의 아이템 #3
장 컨디션 리셋 팩`,description:"장 건강 루틴을 위한 베스트 조합. 아침 루틴으로 시작하기 좋습니다.",promoText:`편안한 하루를 위한
장 건강 제안`,image:"/dist/img/products/p3.svg",detailId:3},{subtitle:"APRIL CURATION",title:`이달의 아이템 #4
이너뷰티 스타터`,description:"피부 탄력과 보습을 동시에 챙길 수 있는 뷰티 루틴 셀렉션입니다.",promoText:`오늘부터 시작하는
이너뷰티 루틴`,image:"/dist/img/products/p4.svg",detailId:4}],x={WELCOME20:{type:"percent",value:20,label:"신규회원 20%"},FREESHIP:{type:"shipping",value:3e3,label:"배송비 무료"}},O=[{key:"all",label:"전체 리뷰"},{key:"5",label:"5점 리뷰"},{key:"4",label:"4점 이상"},{key:"3",label:"3점 이하"}],o={body:document.body,promoClose:document.getElementById("promoClose"),monthlyTrack:document.getElementById("monthlyTrack"),monthlyDots:document.getElementById("monthlyDots"),productGrid:document.getElementById("productGrid"),searchInput:document.getElementById("searchInput"),priceFilter:document.getElementById("priceFilter"),sortFilter:document.getElementById("sortFilter"),cartCount:document.getElementById("cartCount"),wishlistCount:document.getElementById("wishlistCount"),cartItems:document.getElementById("cartItems"),wishlistItems:document.getElementById("wishlistItems"),priceSummary:document.getElementById("priceSummary"),couponInput:document.getElementById("couponInput"),reviewSummary:document.getElementById("reviewSummary"),reviewFilterRow:document.getElementById("reviewFilterRow"),reviewCards:document.getElementById("reviewCards"),reviewHighBtn:document.getElementById("reviewHighBtn"),authBtn:document.getElementById("authBtn"),authTitle:document.getElementById("authTitle"),authForm:document.getElementById("authForm"),authEmail:document.getElementById("authEmail"),authPassword:document.getElementById("authPassword"),authName:document.getElementById("authName"),toggleAuthMode:document.getElementById("toggleAuthMode"),checkoutForm:document.getElementById("checkoutForm"),ordersList:document.getElementById("ordersList")};let g=null;function k(t){r.monthlyIndex=t;const e=[...document.querySelectorAll(".monthly-slide")],i=[...document.querySelectorAll(".monthly-dot")];e.forEach((n,a)=>n.classList.toggle("active",a===t)),i.forEach((n,a)=>n.classList.toggle("active",a===t))}function R(){!o.monthlyTrack||!o.monthlyDots||(o.monthlyTrack.innerHTML=E.map((t,e)=>`
      <article class="monthly-slide ${e===0?"active":""}">
        <p class="monthly-promo-text">${t.promoText.replace(/\n/g,"<br />")}</p>
        <div class="monthly-image-wrap">
          <img src="${t.image}" alt="${t.title}" loading="eager" />
        </div>
        <div class="monthly-content">
          <p class="monthly-subtitle">${t.subtitle}</p>
          <h2 class="monthly-title">${t.title.replace(/\n/g,"<br />")}</h2>
          <p class="monthly-desc">${t.description}</p>
          <a class="primary link-btn" href="pages/detail.html?id=${t.detailId}">자세히보기</a>
        </div>
      </article>`).join(""),o.monthlyDots.innerHTML=E.map((t,e)=>`<button class="monthly-dot ${e===0?"active":""}" data-monthly-dot="${e}" aria-label="${e+1}번 배너"></button>`).join(""))}function L(){g&&clearInterval(g),g=setInterval(()=>{const t=(r.monthlyIndex+1)%E.length;k(t)},4e3)}function u(){localStorage.setItem(c.cart,JSON.stringify(r.cart)),localStorage.setItem(c.wishlist,JSON.stringify(r.wishlist)),localStorage.setItem(c.orders,JSON.stringify(r.orders)),localStorage.setItem(c.user,JSON.stringify(r.user)),localStorage.setItem(c.promoHidden,JSON.stringify(r.promoHidden))}function b(){return r.cart.map(t=>{const e=p.find(i=>i.id===t.productId);return e?{...t,product:e}:null}).filter(Boolean)}function C(){const e=b().reduce((s,d)=>s+d.product.price*d.quantity,0),i=e>0&&e<3e4?3e3:0;let n=0,a="-";return r.coupon?.type==="percent"&&(n=Math.floor(e*r.coupon.value/100),a=`${r.coupon.label} (-${l(n)})`),r.coupon?.type==="shipping"&&(n=Math.min(i,r.coupon.value),a=`${r.coupon.label} (-${l(n)})`),{subtotal:e,shipping:i,discount:n,total:Math.max(0,e+i-n),discountText:a}}function A(){const t=o.searchInput.value.trim().toLowerCase(),e=o.priceFilter.value,i=o.sortFilter.value;let n=[...p];if(t&&(n=n.filter(a=>a.name.toLowerCase().includes(t)||a.description.toLowerCase().includes(t)||a.ingredients.some(s=>s.toLowerCase().includes(t)))),e!=="all"){const[a,s]=e.split("-").map(Number);n=n.filter(d=>d.price>=a&&d.price<=s)}return i==="popular"&&n.sort((a,s)=>s.popularScore-a.popularScore),i==="newest"&&n.sort((a,s)=>new Date(s.releaseDate)-new Date(a.releaseDate)),i==="priceAsc"&&n.sort((a,s)=>a.price-s.price),i==="priceDesc"&&n.sort((a,s)=>s.price-a.price),n}function I(){const t=A();if(!t.length){o.productGrid.innerHTML='<p class="empty">조건에 맞는 상품이 없습니다.</p>';return}o.productGrid.innerHTML=t.map(e=>q(e,`pages/detail.html?id=${e.id}`)).join("")}function q(t,e){const i=Math.round((1-t.price/t.originalPrice)*100),n=t.reviews.toLocaleString("ko-KR"),a=H(t.image),s=N(t.image);return`
    <a class="product-card product-card-link" href="${e}" aria-label="${t.name} 상세페이지로 이동">
      <div class="product-thumb">
        <div class="product-badges">
          ${(t.badges||[]).slice(0,2).map(d=>`<span class="product-badge">${d}</span>`).join("")}
        </div>
        <img
          src="${a}"
          data-fallback="${s}"
          alt="${t.name}"
          loading="lazy"
          onerror="if(this.dataset.fallback && this.src !== this.dataset.fallback){this.src=this.dataset.fallback;}"
        />
      </div>
      <div class="product-meta">
        <h4>${t.name}</h4>
        <p>${t.oneLine||t.description}</p>
      </div>
      <div class="price-stack">
        <small class="old-price">${l(t.originalPrice)}</small>
        <div class="new-price-row">
          <span class="discount-rate">${i}%</span>
          <strong class="new-price">${l(t.price)}</strong>
        </div>
      </div>
      <div class="review-count">리뷰 (${n})</div>
    </a>
  `}function P(){let t=[...y];return r.reviewFilter==="5"&&(t=t.filter(e=>e.score===5)),r.reviewFilter==="4"&&(t=t.filter(e=>e.score>=4)),r.reviewFilter==="3"&&(t=t.filter(e=>e.score<=3)),r.reviewHighOnly&&(t=t.filter(e=>e.score>=5)),t.sort((e,i)=>i.helpful-e.helpful)}function j(){const t={5:0,4:0,3:0,2:0,1:0};y.forEach(n=>t[n.score]+=1);const e=y.length,i=(y.reduce((n,a)=>n+a.score,0)/e).toFixed(1);o.reviewSummary.innerHTML=`
    <div class="review-score">
      <strong>${i}</strong>
      <div>${"★".repeat(Math.round(Number(i)))}${"☆".repeat(5-Math.round(Number(i)))}</div>
      <small>총 ${e}개 리뷰</small>
    </div>
    <div class="review-bars">
      ${[5,4,3,2,1].map(n=>{const a=t[n],s=e?Math.round(a/e*100):0;return`<div class="review-bar"><span>${n}점</span><div class="review-bar-track"><div class="review-bar-fill" style="width:${s}%"></div></div><span>${a}</span></div>`}).join("")}
    </div>`}function F(){o.reviewFilterRow.innerHTML=O.map(t=>`<button class="review-chip ${r.reviewFilter===t.key?"active":""}" data-review-filter="${t.key}">${t.label}</button>`).join("")}function B(){const t=P();if(!t.length){o.reviewCards.innerHTML='<p class="empty">선택된 조건의 리뷰가 없습니다.</p>';return}o.reviewCards.innerHTML=t.map(e=>{const i=p.find(n=>n.id===e.productId);return`<article class="review-card">
        <div class="review-card-head"><span>${e.user} · ${e.date}</span><strong>${"★".repeat(e.score)}${"☆".repeat(5-e.score)}</strong></div>
        <p>${e.text}</p>
        <small style="color:#5d7683">구매 옵션: ${e.option}</small>
        <div class="review-foot"><span>도움돼요 ${e.helpful}</span><a class="text-btn link-btn" href="pages/detail.html?id=${e.productId}">${i?.name||"상품"} 보기</a></div>
      </article>`}).join("")}function m(){const t=b();o.cartCount.textContent=r.cart.reduce((i,n)=>i+n.quantity,0),o.cartItems.innerHTML=t.length===0?'<p class="empty">장바구니가 비어 있습니다.</p>':t.map(i=>`<article class="cart-item"><strong>${i.product.name}</strong><p>${l(i.product.price)} x ${i.quantity}</p><div style="display:flex;justify-content:space-between;align-items:center;gap:8px;"><div class="qty-controls"><button data-action="decreaseQty" data-id="${i.product.id}">-</button><span>${i.quantity}</span><button data-action="increaseQty" data-id="${i.product.id}">+</button></div><button class="text-btn" data-action="removeFromCart" data-id="${i.product.id}">삭제</button></div></article>`).join("");const e=C();o.priceSummary.innerHTML=`<div>상품금액 <strong>${l(e.subtotal)}</strong></div><div>배송비 <strong>${l(e.shipping)}</strong></div><div>할인 <strong>${e.discount?"-":""}${l(e.discount)}</strong></div><div style="color:#5d7683;font-size:0.82rem">${e.discountText}</div><div style="font-size:1.04rem">총 결제금액 <strong>${l(e.total)}</strong></div>`}function T(){const t=p.filter(e=>r.wishlist.includes(e.id));o.wishlistCount.textContent=r.wishlist.length,o.wishlistItems.innerHTML=t.length===0?'<p class="empty">찜한 상품이 없습니다.</p>':t.map(e=>`<article class="wish-item"><strong>${e.name}</strong><p>${l(e.price)}</p><div style="display:flex;gap:8px;"><button class="primary" data-action="addToCart" data-id="${e.id}">장바구니 담기</button><button class="text-btn" data-action="toggleWish" data-id="${e.id}">삭제</button></div></article>`).join("")}function S(){if(!r.orders.length){o.ordersList.innerHTML='<p class="empty">아직 주문 내역이 없습니다.</p>';return}o.ordersList.innerHTML=r.orders.slice().reverse().map(t=>`<article class="order-item"><strong>${t.orderId} · ${t.date}</strong><p>${t.items.map(e=>`${e.name} x ${e.quantity}`).join(", ")}</p><p>결제수단: ${D(t.paymentMethod)} · 총액: ${l(t.total)}</p><button class="ghost" data-action="reorder" data-order-id="${t.orderId}">재주문</button></article>`).join("")}function M(){o.authBtn.textContent=r.user?`${r.user.name}님`:"로그인"}function $(t,e=1){const i=p.find(a=>a.id===t);if(!i)return;const n=r.cart.find(a=>a.productId===t);n?n.quantity=Math.min(n.quantity+e,i.stock):r.cart.push({productId:t,quantity:Math.min(e,i.stock)}),m(),u()}function J(t){r.wishlist=r.wishlist.includes(t)?r.wishlist.filter(e=>e!==t):[...r.wishlist,t],I(),T(),u()}function v(t){document.getElementById(t).classList.add("open")}function f(t){document.getElementById(t).classList.remove("open")}function w(t){document.getElementById(t).classList.remove("open")}function h(t){document.getElementById(t).classList.add("open")}function G(){return r.user?!0:(h("authModal"),!1)}function U(t){const e=b();if(!e.length)return;const i=C(),n={orderId:`SL-${Date.now().toString().slice(-8)}`,date:new Date().toLocaleDateString("ko-KR"),paymentMethod:t.paymentMethod,items:e.map(a=>({name:a.product.name,quantity:a.quantity})),total:i.total};r.orders.push(n),r.cart=[],r.coupon=null,u(),m(),S(),w("checkoutModal"),f("cartDrawer"),h("ordersModal")}function W(){[o.searchInput,o.priceFilter,o.sortFilter].forEach(t=>{t.addEventListener("input",I),t.addEventListener("change",I)}),o.monthlyDots&&o.monthlyDots.addEventListener("click",t=>{const e=t.target.closest("[data-monthly-dot]");e&&(k(Number(e.dataset.monthlyDot)),L())}),o.monthlyTrack&&(o.monthlyTrack.addEventListener("mouseenter",()=>{g&&clearInterval(g)}),o.monthlyTrack.addEventListener("mouseleave",L)),o.reviewFilterRow.addEventListener("click",t=>{const e=t.target.closest("[data-review-filter]");e&&(r.reviewFilter=e.dataset.reviewFilter,F(),B())}),o.reviewHighBtn.addEventListener("click",()=>{r.reviewHighOnly=!r.reviewHighOnly,o.reviewHighBtn.textContent=r.reviewHighOnly?"전체 리뷰 보기":"평점 4.5 이상만 보기",B()}),document.addEventListener("click",t=>{const e=t.target,i=e.dataset.action;if(i==="addToCart"&&($(Number(e.dataset.id),1),v("cartDrawer")),i==="toggleWish"&&J(Number(e.dataset.id)),i==="removeFromCart"&&(r.cart=r.cart.filter(n=>n.productId!==Number(e.dataset.id)),m(),u()),i==="increaseQty"&&$(Number(e.dataset.id),1),i==="decreaseQty"){const n=r.cart.find(a=>a.productId===Number(e.dataset.id));if(!n)return;n.quantity-=1,n.quantity<=0&&(r.cart=r.cart.filter(a=>a.productId!==Number(e.dataset.id))),m(),u()}if(i==="reorder"){const n=r.orders.find(a=>a.orderId===e.dataset.orderId);if(!n)return;n.items.forEach(a=>{const s=p.find(d=>d.name===a.name);s&&$(s.id,a.quantity)}),w("ordersModal"),v("cartDrawer")}e.dataset.close&&(e.dataset.close.includes("Drawer")?f(e.dataset.close):w(e.dataset.close)),e.id==="cartBtn"&&v("cartDrawer"),e.id==="wishlistBtn"&&v("wishlistDrawer"),e.id==="ordersBtn"&&(S(),h("ordersModal")),e.id==="authBtn"&&(r.user&&confirm("로그아웃 하시겠습니까?")?(r.user=null,u(),M()):r.user||h("authModal"))}),document.addEventListener("click",t=>{const e=t.target.closest(".drawer"),i=t.target.closest("#cartBtn, #wishlistBtn");!e&&!i&&(f("cartDrawer"),f("wishlistDrawer"))}),document.querySelectorAll(".modal").forEach(t=>{t.addEventListener("click",e=>{e.target===t&&t.classList.remove("open")})}),document.getElementById("applyCouponBtn").addEventListener("click",()=>{const t=o.couponInput.value.trim().toUpperCase(),e=x[t];if(!e){alert("사용할 수 없는 쿠폰입니다.");return}r.coupon=e,m()}),document.getElementById("checkoutBtn").addEventListener("click",()=>{if(!b().length){alert("장바구니가 비어 있습니다.");return}G()&&h("checkoutModal")}),o.authForm.addEventListener("submit",t=>{t.preventDefault();const e=o.authEmail.value.trim(),i=o.authPassword.value.trim(),n=o.authName.value.trim();if(!(!e||!i)){if(r.authMode==="signup"){if(!n)return alert("이름을 입력해주세요.");r.user={email:e,name:n}}else r.user={email:e,name:e.split("@")[0]};u(),M(),w("authModal"),o.authForm.reset()}}),o.toggleAuthMode.addEventListener("click",()=>{r.authMode=r.authMode==="login"?"signup":"login";const t=r.authMode==="signup";o.authTitle.textContent=t?"회원가입":"로그인",o.authName.classList.toggle("hidden",!t),o.toggleAuthMode.textContent=t?"로그인 하기":"회원가입 하기"}),o.checkoutForm.addEventListener("submit",t=>{t.preventDefault();const e=Object.fromEntries(new FormData(o.checkoutForm).entries());if(!e.paymentMethod)return alert("결제수단을 선택해주세요.");U(e),o.checkoutForm.reset()}),o.promoClose.addEventListener("click",()=>{r.promoHidden=!0,o.body.classList.add("promo-hidden"),u()})}function Q(){r.promoHidden&&o.body.classList.add("promo-hidden"),R(),k(0),L(),I(),j(),F(),B(),m(),T(),S(),M(),W()}Q();
